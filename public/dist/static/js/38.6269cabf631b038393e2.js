webpackJsonp([38],{"U/6C":function(e,t){},X4tq:function(e,t){},"xi/t":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("BO1k"),n=a.n(r),o=a("Xxa5"),s=a.n(o),i=a("exGp"),l=a.n(i),u=a("vLgD");function c(e){return Object(u.a)({url:"user/viewConfig/selectConfigList",method:"post",data:e})}function p(e){return Object(u.a)({url:"user/viewConfig/updateConfig",method:"post",data:e})}function g(e){return Object(u.a)({url:"user/viewConfig/selectGroupSort",method:"post",data:e})}var m=a("TIfe"),f=a("X2Oc"),d=a("u4Bf"),h={name:"personcenter",data:function(){return{userConfig:[],pageConfig:{currentPage:1,pageSize:10},uploadFileList:[],operateType:null,operateBol:!1,operateObj:null,compressBol:!0,typeNumConfig:[{value:"1",name:"我的福利"},{value:"2",name:"我的服务"},{value:"3",name:"热门借款"},{value:"4",name:"我的频道"},{value:"5",name:"收金币"},{value:"6",name:"今日特惠"}],groupSeqBol:!1,loginArray:[{name:"是",value:!0},{name:"否",value:!1}],statusArray:[{value:1,name:"在用"},{value:0,name:"停用"}],groupSeqData:[{typeNum:1,groupSeq:2},{typeNum:2,groupSeq:3},{typeNum:3,groupSeq:4},{typeNum:4,groupSeq:1}],rules:{groupName:[{validator:function(e,t,a){/^[1-4]$/.test(t)?a():a(new Error("请输入1~4之间的数字"))}}],typeName:[{required:!0,message:"必填项哦~",trigger:"blur"}],imgUrl:[{required:!0,message:"必填项哦~"}],groupSeq:[{type:"number",required:!0,message:"必填项哦~"}],gotoUrl:[{required:!0,message:"必填项哦~"}]},appMainStyle:null,tableStyle:null,tableNumHeight:null,searchName:null,status:null,searchType:null}},computed:{operateTypeDesc:function(){return 0===this.operateType?"新增":"修改"},uploadUrl:function(){return"https://www.xiaoxiangyoupin.com/xxyp-manager/upload/uploadPic"},uploadHeader:function(){return{Token:Object(m.c)()}}},mounted:function(){var e=this;return l()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.fetchUserConfig(),e.computeViewArea(),e.computeTableArea();case 3:case"end":return t.stop()}},t,e)}))()},methods:{fetchUserConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments[2],r=this,n=arguments[3],o=arguments[4];return l()(s.a.mark(function i(){var l,u;return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r.pageConfig={pageSize:t,currentPage:e},l={currentPage:e,pageSize:t},a&&(l.typeNum=a),n&&(l.typeName=n),0!==o&&1!==o||(l.status=o),s.next=7,c(l);case 7:u=s.sent,r.userConfig=u.dataList,r.pageConfig.total=u.totalSize;case 10:case"end":return s.stop()}},i,r)}))()},addConfig:function(){this.operateType=0,this.operateBol=!0,this.operateObj={typeNum:"1",typeName:"",imgUrl:"",gotoUrl:"",orderSeq:1,loginFlag:""}},editConfig:function(e){this.operateType=1,this.operateBol=!0,this.uploadFileList=[{name:e.imgUrl,url:e.imgUrl}],this.operateObj={id:e.id,typeNum:String(e.typeNum),typeName:e.typeName,imgUrl:e.imgUrl,gotoUrl:e.gotoUrl,orderSeq:e.orderSeq,loginFlag:e.loginFlag}},deleteConfig:function(e){var t=this;this.$confirm("此操作将删除该配置, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return t={id:e.id},Object(u.a)({url:"user/viewConfig/deleteConfig",method:"post",data:t});var t}).then(function(e){console.log("res: ",e),t.$message({type:"success",message:e.message}),t.fetchUserConfig(t.pageConfig.currentPage,t.pageConfig.pageSize,t.searchType,t.searchName,t.status)}).catch(function(e){console.log("err: ",e),"cancel"===e&&(e="已取消"),t.$message({type:"info",message:String(e)})})},changeConfig:function(e){var t=this;this.$confirm("此操作将更改该配置状态, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t,a=void 0;return a=0===e.status?1:0,t={id:e.id,status:a},Object(u.a)({url:"user/viewConfig/enableOrNot",method:"post",data:t})}).then(function(e){console.log("res: ",e),t.$message({type:"success",message:e.message}),t.fetchUserConfig(t.pageConfig.currentPage,t.pageConfig.pageSize)}).catch(function(e){console.log("err: ",e),"cancel"===e&&(e="已取消"),t.$message({type:"info",message:String(e)})})},searchConfigData:function(){this.searchType||this.searchName||1===this.status||0===this.status?this.fetchUserConfig(1,10,this.searchType,this.searchName,this.status):this.$message("搜索条件不能为空!")},groupSeq:function(){var e=this;return l()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return window.$emuiLoading=e.$loading(),t.next=3,g();case 3:a=t.sent,window.$emuiLoading.close(),e.groupSeqData=a.data,e.groupSeqData.sort(function(e,t){return e.groupSeq-t.groupSeq}),e.groupSeqBol=!0;case 8:case"end":return t.stop()}},t,e)}))()},cancelGroupSeq:function(){this.groupSeqBol=!1,this.groupSeqData=[]},sumitGroupSeq:function(){var e=this;return l()(s.a.mark(function t(){var a,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=[],e.groupSeqData.forEach(function(e,t){a.push({typeNum:e.typeNum,groupSeq:t+1})}),window.$emuiLoading=e.$loading(),e.groupSeqBol=!1,t.next=6,n=a,Object(u.a)({url:"user/viewConfig/updateGroupSort",method:"post",data:n});case 6:r=t.sent,window.$emuiLoading.close(),e.$message(r.message);case 9:case"end":return t.stop()}var n},t,e)}))()},submitForm:function(e){var t=this;return l()(s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=l()(s.a.mark(function e(a){var r,o,i,l,c,g,m,f,d,h;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=49;break}r=t.operateObj,o=!0,i=!1,l=void 0,e.prev=5,c=n()(t.typeNumConfig);case 7:if(o=(g=c.next()).done){e.next=16;break}if(m=g.value,f=m.name,m.value!==r.typeNum){e.next=13;break}return r.groupName=f,e.abrupt("break",16);case 13:o=!0,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),i=!0,l=e.t0;case 22:e.prev=22,e.prev=23,!o&&c.return&&c.return();case 25:if(e.prev=25,!i){e.next=28;break}throw l;case 28:return e.finish(25);case 29:return e.finish(22);case 30:if(r.typeNum=parseInt(r.typeNum),0!==t.operateType){e.next=37;break}return e.next=34,s=r,Object(u.a)({url:"user/viewConfig/insertConfig",method:"post",data:s});case 34:e.t1=e.sent,e.next=40;break;case 37:return e.next=39,p(r);case 39:e.t1=e.sent;case 40:d=e.t1,t.$message(d.message),t.operateBol=!1,t.operateObj=null,t.uploadFileList=[],h=t.pageConfig,t.fetchUserConfig(h.currentPage,h.pageSize,t.searchType,t.searchName,t.status),e.next=51;break;case 49:return t.$message("表单未填写正确，无法提交"),e.abrupt("return",!1);case 51:case"end":return e.stop()}var s},e,t,[[5,18,22,30],[23,,25,29]])}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}},a,t)}))()},resetForm:function(e){this.$refs[e].resetFields(),this.uploadFileList=[]},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.fetchUserConfig(void 0,e,this.searchType,this.searchName,this.status)},handleCurrentChange:function(e){var t=this;return l()(s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:console.log("当前页 "+e+" 条"),t.fetchUserConfig(e,10,t.searchType,t.searchName,t.status);case 2:case"end":return a.stop()}},a,t)}))()},handleRemove:function(e,t){console.log("handleRemove",e,t),0===t.length&&(this.operateObj.imgUrl="")},handleSuccess:function(e,t,a){a.length>1&&a.splice(0,1),200===e.code?this.operateObj.imgUrl=e.data:this.$message("图片上传失败,"+(e.message||e.errorMsg))},handleError:function(e,t,a){this.$message("文件上传失败: "+String(e))},handleConfigClose:function(){this.operateBol=!1,this.uploadFileList=[]},handleGroupSeqClose:function(){this.groupSeqBol=!1,this.groupSeqData=[]},computeViewArea:function(){var e=Object(f.a)(),t=document.querySelector(".btns-area").getBoundingClientRect();this.appMainStyle={width:window.innerWidth-e.left+"px",height:window.innerHeight-t.top+"px"}},computeTableArea:function(){var e=window.getComputedStyle(document.querySelector(".table-out-wrap")).paddingTop.match(/([\d\.]+)/)[0],t=window.getComputedStyle(document.querySelector(".pagination-wrap")).height.match(/([\d\.]+)/)[0],a=document.querySelector(".btns-area").getBoundingClientRect();console.log(window.innerHeight,a.top,Number(t),e),this.tableNumHeight=window.innerHeight-a.bottom-Number(t)-2*Number(e),this.tableStyle={width:"100%",height:this.tableNumHeight+Number(e)+"px"}}},watch:{uploadFileList:function(e){var t=this.uploadFileList,a=this.operateObj;a&&(t.length>0?a.imgUrl=t[0].url:a&&(a.imgUrl=""))}},components:{draggable:a.n(d).a},filters:{typeNumText:function(e){switch(e){case 1:return"我的福利";case 2:return"我的服务";case 3:return"热门借款";case 4:return"我的频道";case 5:return"收金币";case 6:return"今日特惠"}}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"personcenter-root",style:e.appMainStyle},[a("div",{staticClass:"padding-wrap btns-area"},[a("el-button",{on:{click:e.addConfig}},[e._v("新增配置")]),e._v(" "),a("el-button",{on:{click:e.groupSeq}},[e._v("修改分组排序")]),e._v(" "),a("div",{staticClass:"search-wrap"},[a("el-input",{attrs:{placeholder:"请输入名称",clearable:""},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}}),e._v(" "),a("el-select",{attrs:{clearable:""},model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},e._l(e.typeNumConfig,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),e._v(" "),a("el-select",{attrs:{clearable:""},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.statusArray,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),e._v(" "),a("el-button",{on:{click:e.searchConfigData}},[e._v("搜索")])],1)],1),e._v(" "),a("div",{staticClass:"padding-wrap table-out-wrap",style:e.tableStyle},[a("el-table",{staticClass:"user-table",attrs:{data:e.userConfig,height:e.tableNumHeight,border:"","highlight-current-row":!0,"cell-class-name":"user-cell"},on:{"update:height":function(t){e.tableNumHeight=t}}},[a("el-table-column",{attrs:{prop:"typeNum",label:"类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"groupName",label:"分组名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"typeName",label:"配置名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"imgUrl",label:"图片地址"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"config-img",attrs:{src:e.row.imgUrl}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"gotoUrl",label:"跳转地址"}}),e._v(" "),a("el-table-column",{attrs:{prop:"orderSeq",label:"组内排序"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否需要登入"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.loginFlag?"是":"否"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"修改",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.status?a("el-button",{attrs:{type:"warning"},on:{click:function(a){e.changeConfig(t.row)}}},[e._v("停用")]):e._e(),e._v(" "),0===t.row.status?a("el-button",{attrs:{type:"success"},on:{click:function(a){e.changeConfig(t.row)}}},[e._v("启用")]):e._e(),e._v(" "),a("el-button",{on:{click:function(a){e.editConfig(t.row)}}},[e._v("修改")]),e._v(" "),a("el-button",{on:{click:function(a){e.deleteConfig(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"margin-wrap pagination-wrap"},[a("el-pagination",{attrs:{background:"","current-page":e.pageConfig.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageConfig.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageConfig.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[e._v("\n    >")])],1),e._v(" "),a("el-dialog",{attrs:{title:e.operateTypeDesc,visible:e.operateBol,"before-close":e.handleConfigClose}},[e.operateBol?a("el-form",{ref:"form",attrs:{model:e.operateObj,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"分组名称"}},[a("el-select",{model:{value:e.operateObj.typeNum,callback:function(t){e.$set(e.operateObj,"typeNum",t)},expression:"operateObj.typeNum"}},e._l(e.typeNumConfig,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"配置名称",prop:"typeName"}},[a("el-input",{model:{value:e.operateObj.typeName,callback:function(t){e.$set(e.operateObj,"typeName",t)},expression:"operateObj.typeName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"图片地址",prop:"imgUrl"}},[a("el-upload",{attrs:{action:e.uploadUrl,"on-remove":e.handleRemove,"on-success":e.handleSuccess,"on-error":e.handleError,"file-list":e.uploadFileList,"list-type":"picture",limit:2,headers:e.uploadHeader}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),a("br"),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("建议上传文件大小不超过500kb")]),e._v(" "),a("br")],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"跳转地址",prop:"gotoUrl"}},[a("el-input",{model:{value:e.operateObj.gotoUrl,callback:function(t){e.$set(e.operateObj,"gotoUrl",t)},expression:"operateObj.gotoUrl"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"组内排序",prop:"orderSeq"}},[a("el-input",{model:{value:e.operateObj.orderSeq,callback:function(t){e.$set(e.operateObj,"orderSeq",t)},expression:"operateObj.orderSeq"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否登入"}},[a("el-select",{model:{value:e.operateObj.loginFlag,callback:function(t){e.$set(e.operateObj,"loginFlag",t)},expression:"operateObj.loginFlag"}},e._l(e.loginArray,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("form")}}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:function(t){e.resetForm("form")}}},[e._v("取消")])],1)],1):e._e()],1),e._v(" "),a("el-dialog",{attrs:{title:"请上下拖动元素，修改分组排序",visible:e.groupSeqBol,"before-close":e.handleGroupSeqClose}},[a("draggable",{model:{value:e.groupSeqData,callback:function(t){e.groupSeqData=t},expression:"groupSeqData"}},e._l(e.groupSeqData,function(t,r){return a("div",{key:t.groupSeq,staticClass:"group-el"},[e._v("\n      "+e._s(e._f("typeNumText")(t.typeNum))+"\n    ")])})),e._v(" "),a("div",{staticClass:"mt15"},[a("el-button",{attrs:{type:"primary"},on:{click:e.sumitGroupSeq}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:e.cancelGroupSeq}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var b=a("VU/8")(h,v,!1,function(e){a("X4tq"),a("U/6C")},"data-v-448862e6",null);t.default=b.exports}});