webpackJsonp([92],{jFMF:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("c/Tr"),o=i.n(s),n=i("mvHQ"),a=i.n(n),l=i("Dd8w"),r=i.n(l),c=i("nv77"),d=i("NYxO"),u={name:"role",data:function(){return{listLoading:!0,listQuery:{name:void 0},roleList:["admin","normal"],rules:{name:[{required:!0,trigger:"blur",validator:function(e,t,i){void 0===t||t.length<0?i(new Error("角色名不能为空")):i()}}],roleKey:[{required:!0,trigger:"blur",validator:function(e,t,i){void 0===t||t.length<0?i(new Error("角色Key不能为空")):i()}}]},textMap:{create:"新建角色",modify:"修改角色",permission:"分配权限"},dialogStatus:"",dialogFormVisible:!1,permissionFormVisible:!1,temp:{id:void 0,username:void 0,password:void 0},tableKey:0,list:null,permissions:[],hasPermissions:void 0,defaultProps:{children:"children",label:"name"},tempCopy:{}}},created:function(){this.fetchData()},computed:r()({},Object(d.b)(["menus"])),methods:{fetchData:function(){var e=this;this.listLoading=!0,Object(c.j)(this.listQuery).then(function(t){e.list=t.dataList,e.listLoading=!1})},resetTemp:function(){this.temp={id:void 0,username:void 0,password:void 0}},saveAddRole:function(){var e=this;this.$refs.dataForm.validate(function(t){t&&(e.tempCopy.deleted=0,Object(c.a)(e.tempCopy).then(function(t){e.$message({message:"添加角色成功",type:"success"}),e.dialogFormVisible=!1,e.fetchData()}))})},addRole:function(){this.tempCopy={},this.tempCopy.id=void 0,this.tempCopy.username=void 0,this.tempCopy.password=void 0,this.dialogStatus="create",this.dialogFormVisible=!0},modifyRole:function(e){this.temp=e,this.tempCopy=JSON.parse(a()(e)),console.log("添加"),console.log(this.tempCopy),this.dialogStatus="modify",this.dialogFormVisible=!0},saveModifyRole:function(){var e=this;this.temp=this.tempCopy,this.$refs.dataForm.validate(function(t){t&&(e.temp.deleted=0,Object(c.p)(e.temp).then(function(t){e.$message({message:"修改成功",type:"success"}),e.tempCopy={},e.dialogFormVisible=!1,e.fetchData()}))})},hideModify:function(){console.log(this.temp),this.tempCopy={},this.dialogFormVisible=!1},grantPermission:function(e){var t=this;this.permissionFormVisible=!0,this.dialogStatus="permission",this.temp=e,this.hasPermissions=[],this.checkResult=[];var i=this;Object(c.i)(e.id).then(function(e){console.log(e.data.menus);var s=[];o()(e.data.menus).forEach(function(e){s.push(e.id),i.checkResult.push(e.id)}),t.$refs.tree.setCheckedNodes(s)}).then(function(e){Object(c.g)().then(function(e){t.permissions=e.dataList;for(var s=t.filterBaseId(t.permissions),o=0;o<i.checkResult.length;o++)for(var n=0;n<s.length;n++)t.checkResult[o]===s[n]&&t.hasPermissions.push(t.checkResult[o])})}),this.defaultProps={children:"children",label:"name"}},savePermission:function(){var e=this,t=[];o()(this.$refs.tree.getCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),o()(this.$refs.tree.getHalfCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),this.temp.menus=t,Object(c.c)(this.temp).then(function(t){e.$message({message:"分配权限成功",type:"success"}),e.permissionFormVisible=!1})},deleteRole:function(e){var t=this;this.$confirm("删除该角色影响对应用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){Object(c.f)({id:e.id}).then(function(e){t.$message({message:"删除角色成功",type:"success"}),t.fetchData()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},filterBaseId:function(e){for(var t=[],i=0;i<e.length;i++)s(e[i]);function s(e){if(e.children)for(var i=0;i<e.children.length;i++)s(e.children[i]);else t.push(e.id)}return t}}},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"operation-container"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.add"),expression:"menus.indexOf('account.role.add')!==-1"}],staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-plus"},on:{click:function(t){e.addRole()}}},[e._v("添加")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,"element-loading-text":"加载中",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",width:"65",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.$index+1))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"角色名",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"角色key",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.roleKey))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"描述",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.description))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"创建时间",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-time"}),e._v(" "),i("span",[e._v(e._s(t.row.createTime))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",align:"center","min-width":"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.modify"),expression:"menus.indexOf('account.role.modify')!==-1"}],attrs:{type:"primary",size:"small"},on:{click:function(i){e.modifyRole(t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.grant"),expression:"menus.indexOf('account.role.grant')!==-1"}],attrs:{type:"primary",size:"small"},on:{click:function(i){e.grantPermission(t.row)}}},[e._v("角色权限")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.delete"),expression:"menus.indexOf('account.role.delete')!==-1"}],attrs:{type:"danger",size:"mini"},on:{click:function(i){e.deleteRole(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.tempCopy,"label-position":"left","label-width":"90px"}},[i("el-form-item",{attrs:{label:"角色名",prop:"name"}},[i("el-input",{model:{value:e.tempCopy.name,callback:function(t){e.$set(e.tempCopy,"name",t)},expression:"tempCopy.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色key",prop:"roleKey"}},[i("el-input",{model:{value:e.tempCopy.roleKey,callback:function(t){e.$set(e.tempCopy,"roleKey",t)},expression:"tempCopy.roleKey"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色描述"}},[i("el-input",{model:{value:e.tempCopy.description,callback:function(t){e.$set(e.tempCopy,"description",t)},expression:"tempCopy.description"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.hideModify}},[e._v("取消")]),e._v(" "),"create"==e.dialogStatus?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveAddRole()}}},[e._v("添加")]):i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveModifyRole()}}},[e._v("更新")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.permissionFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.permissionFormVisible=t}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"250px","margin-left":"50px"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[i("el-tree",{ref:"tree",attrs:{data:e.permissions,"show-checkbox":"","node-key":"id","default-expanded-keys":[11e4,12e4,13e4],"default-checked-keys":e.hasPermissions,"highlight-current":"",props:e.defaultProps}})],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.permissionFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.savePermission()}}},[e._v("分配")])],1)],1)],1)},staticRenderFns:[]},p=i("VU/8")(u,m,!1,null,null,null);t.default=p.exports}});