webpackJsonp([91],{jukF:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("c/Tr"),i=o.n(a),n=o("lHA8"),r=o.n(n),s=o("//Fk"),l=o.n(s),c=o("voil"),h=o("vLgD");var d={name:"marketingList",mounted:function(){this.getCategoryListServe(),this.getTechCategoryListServe()},data:function(){return{showRemoveCategoryRelation:!1,showLoading:!1,showLinkListDialog:!1,showSetNameDialog:!1,showDelDialog:!1,showCreateDialog:!1,createObj:{isCreateTwo:!1,name:"",parentId:"",parentLevel:""},delObj:{isDelTwo:!1,id:""},setNameObj:{name:"",isSetTwo:!1},linkObj:{id:"",linkArr:[],relationIds:[]},form:{name:""},formLabelWidth:"100px",data2:[],defaultProps:{children:"children",label:"categoryName"},categoryList:[],openRowArr:[],mapOpenRowArr:[]}},methods:{cancelCreateDialog:function(){this.showCreateDialog=!1},canceSetNameDialog:function(){this.showSetNameDialog=!1},submitCreate:function(){this.createObj.isCreateTwo?this.insertCategoryServe(this.createObj.parentId,this.createObj.name,this.createObj.parentLevel):this.insertCategoryServe(this.createObj.parentId,this.createObj.name,0),this.showCreateDialog=!1},submitSetName:function(){this.updateCategoryServe(this.setNameObj.id,this.setNameObj.name),this.showSetNameDialog=!1},submitDel:function(){this.delObj.isDelTwo,this.deleteCategoryServe(this.delObj.id),this.showDelDialog=!1},submitRelation:function(){for(var e=[],t=0;t<this.linkObj.linkArr.length;t++){var o=this.linkObj.linkArr[t];o.show&&e.push(o.id)}this.relationCategoryServe(this.linkObj.id,e),this.showLinkListDialog=!1,this.linkObj.linkArr=[],this.linkObj.id="",this.linkObj.relationIds=[]},cancelRelation:function(){this.showLinkListDialog=!1,this.linkObj.id="",this.linkObj.linkArr=[]},openSetNameDialog:function(e,t){t?(this.setNameObj.isSetTwo=!0,this.setNameObj.name=t.row.categoryName,this.setNameObj.id=t.row.id,this.openRowArr.push(e.row.id)):(this.setNameObj.isSetTwo=!1,this.setNameObj.name=e.row.categoryName,this.setNameObj.id=e.row.id),this.showSetNameDialog=!0},openDelDialog:function(e,t){t?(this.delObj.isDelTwo=!0,this.delObj.id=t.row.id,this.openRowArr.push(e.row.id)):(this.delObj.isDelTwo=!1,this.delObj.id=e.row.id),this.showDelDialog=!0},openLinkListDialog:function(e,t){this.linkObj.id=t.row.id,this.getCategoryRelationServe(this.linkObj.id),this.openRowArr.push(e.row.id)},filterChecked:function(){var e=this;return new l.a(function(t,o){for(var a=0;a<e.data2.length;a++)for(var i=0;i<e.data2[a].children.length;i++)for(var n=e.data2[a].children[i],r=0;r<n.children.length;r++){var s=n.children[r];e.linkObj.linkArr.push({oneName:e.data2[a].categoryName,twoName:e.data2[a].children[i].categoryName,threeName:s.categoryName,id:s.id,show:!1})}t([])}).then(function(e){console.log(e)})},openCreateDialog:function(e){e?(this.openRowArr.push(e.row.id),this.createObj={isCreateTwo:!0,name:"",parentId:e.row.id,parentLevel:e.row.level},console.log(this.createObj)):(this.createObj={isCreateTwo:!1,name:"",parentId:0},console.log(this.createObj)),this.showCreateDialog=!0},insertCategoryServe:function(e,t,o){var a,i=this;this.showLoading=!0,(a={parentId:e,categoryName:t,parentLevel:o},Object(h.a)({url:"/category/marketing/insertCategory",method:"post",data:a})).then(function(e){i.$message({message:"添加成功",type:"success"}),i.getCategoryListServe(),i.showLoading=!1}).catch(function(e){i.showLoading=!1,i.$message.error(e)})},updateCategoryServe:function(e,t){var o,a=this;this.showLoading=!0,(o={id:e,categoryName:t},Object(h.a)({url:"/category/marketing/updateCategory",method:"post",data:o})).then(function(e){a.$message({message:"修改成功",type:"success"}),a.getCategoryListServe(),a.showLoading=!1}).catch(function(e){a.showLoading=!1,a.$message.error(e)})},getCategoryListServe:function(){var e=this;Object(h.a)({url:"/category/marketing/getCategoryList",method:"post"}).then(function(t){e.categoryList=t.data,e.showLoading=!1}).then(function(t){var o=new r.a(e.openRowArr);e.mapOpenRowArr=i()(o)}).catch(function(t){e.showLoading=!1,e.$message.error(t)})},deleteCategoryServe:function(e){var t,o=this;this.showLoading=!0,(t={id:e},Object(h.a)({url:"/category/marketing/deleteCategory",method:"post",data:t})).then(function(e){o.$message({message:"删除成功",type:"success"}),o.getCategoryListServe(),o.showLoading=!1}).catch(function(e){o.showLoading=!1,o.$message.error(e)})},submitRemoveCategory:function(){this.showLoading=!0,this.removeCategoryRelationServe(this.linkObj.id),this.showRemoveCategoryRelation=!1},submitRemoveCategoryButton:function(){this.showLoading=!0,this.removeCategoryRelationServe(this.linkObj.id),this.showLinkListDialog=!1,this.getCategoryListServe()},removeCategoryRelationServe:function(e){var t,o=this;this.showLoading=!0,(t={id:e},Object(h.a)({url:"/category/marketing/removeCategoryRelation",method:"post",data:t})).then(function(e){o.$message({message:"取消关联成功",type:"success"}),o.linkObj.relationIds=[],o.linkObj.id="",o.linkObj.linkArr=[],o.getCategoryListServe(),o.showLoading=!1}).catch(function(e){o.showLoading=!1,o.$message.error(e)})},relationCategoryServe:function(e,t){var o,a=this;this.showLoading=!0,(o={id:e,relationIds:t.join(",")},Object(h.a)({url:"/category/marketing/relationCategory",method:"post",data:o})).then(function(e){a.$message({message:"关联成功",type:"success"}),a.getCategoryListServe(),a.showLoading=!1,a.linkObj.id="",a.linkObj.linkArr=[]}).catch(function(e){a.linkObj.id="",a.linkObj.linkArr=[],a.showLoading=!1,a.$message.error(e)})},checkChange:function(e,t,o){this.linkObj.linkArr.forEach(function(e){e.show=!1});var a=this.$refs.tree.getCheckedNodes();console.log(a);for(var i=0;i<this.linkObj.linkArr.length;i++)for(var n=this.linkObj.linkArr[i],r=0;r<a.length;r++)n.id===a[r].id&&(n.show=!0)},getCategoryRelationServe:function(e){var t,o=this;this.filterChecked(),this.showLoading=!0,(t={id:e},Object(h.a)({url:"/category/marketing/getCategoryRelation",method:"post",data:t})).then(function(e){o.linkObj.relationIds=e.data.length>=1?e.data.split(","):[],o.linkObj.relationIds.pop();for(var t=0;t<o.linkObj.relationIds.length;t++)o.linkObj.relationIds[t]=Number(o.linkObj.relationIds[t]);for(var a=0;a<o.linkObj.linkArr.length;a++)o.linkObj.relationIds.includes(o.linkObj.linkArr[a].id)&&(o.linkObj.linkArr[a].show=!0);o.showLoading=!1,o.showLinkListDialog=!0}).then(function(e){o.$refs.tree.setCheckedKeys(o.linkObj.relationIds)}).catch(function(e){o.showLoading=!1,o.$message.error(e)})},getTechCategoryListServe:function(){var e,t=this;this.showLoading=!0,Object(h.a)({url:"/category/marketing/getTechCategoryList",method:"post",data:e}).then(function(e){t.data2=e.data,t.showLoading=!1}).catch(function(e){t.showLoading=!1,t.$message.error(e)})},addKey:function(e){return console.log(e.id),e.id}},components:{Loading:c.a}},g={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"marketingList"},[o("el-row",{staticClass:"classify-header",attrs:{type:"flex",justify:"end",align:"middle"}},[o("el-col",{attrs:{md:21,sm:21}}),e._v(" "),o("el-col",{staticClass:"mb-10 tr",attrs:{md:3,sm:3}},[o("el-button",{attrs:{icon:"el-icon-plus",type:"success"},on:{click:function(t){e.openCreateDialog()}}},[e._v("添加类目")])],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex"}},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],staticStyle:{width:"100%"},attrs:{data:e.categoryList,border:"",stripe:"","row-key":e.addKey,"expand-row-keys":e.mapOpenRowArr}},[o("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[o("el-table",{attrs:{data:t.row.children,stripe:"",border:""}},[o("el-table-column",{attrs:{label:"子分类名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(t.row.categoryName)+"\n\t\t\t\t\t\t\t\t\t")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"创建时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){}}])}),e._v(" "),o("el-table-column",{attrs:{label:"商品数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[o("el-row",[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.openDelDialog(t,a)}}},[e._v("删除类目")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){e.openSetNameDialog(t,a)}}},[e._v("修改名称")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){e.openLinkListDialog(t,a)}}},[e._v("关联类目")])],1)]}}])}),e._v(" "),o("template",{slot:"append"},[o("el-button",{staticClass:"table-button",staticStyle:{margin:"10px"},attrs:{icon:"el-icon-plus",type:"primary"},on:{click:function(o){e.openCreateDialog(t)}}},[e._v("添加子分类")])],1)],2)],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"分类名称",align:"center",prop:"categoryName"}}),e._v(" "),o("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"time"}}),e._v(" "),o("el-table-column",{attrs:{label:"商品数量",align:"center",prop:"desc"}}),e._v(" "),o("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-row",[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.openDelDialog(t)}}},[e._v("删除类目")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){e.openSetNameDialog(t)}}},[e._v("修改名称")])],1)]}}])})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"创建类目",visible:e.showCreateDialog,"close-on-click-modal":!1,"before-close":e.cancelCreateDialog},on:{"update:visible":function(t){e.showCreateDialog=t}}},[o("el-form",{attrs:{model:e.createObj}},[o("el-form-item",{attrs:{label:"类目名称","label-width":e.formLabelWidth}},[o("el-input",{attrs:{placeholder:"请输入需要创建的类目名称"},model:{value:e.createObj.name,callback:function(t){e.$set(e.createObj,"name",t)},expression:"createObj.name"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.cancelCreateDialog}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.submitCreate}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"修改名称",visible:e.showSetNameDialog,"close-on-click-modal":!1,"before-close":e.canceSetNameDialog},on:{"update:visible":function(t){e.showSetNameDialog=t}}},[o("el-form",{attrs:{model:e.setNameObj}},[o("el-form-item",{attrs:{label:"类目名称","label-width":e.formLabelWidth}},[o("el-input",{attrs:{placeholder:"请输入需要修改的类目名称"},model:{value:e.setNameObj.name,callback:function(t){e.$set(e.setNameObj,"name",t)},expression:"setNameObj.name"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.canceSetNameDialog}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.submitSetName}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{visible:e.showDelDialog,width:"30%",title:"删除该分类？","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDelDialog=t}}},[o("p",[o("strong",{staticStyle:{"font-size":"18px"}},[e._v("该分类下的商品不会被删除")])]),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.showDelDialog=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.submitDel}},[e._v("确 定")])],1)]),e._v(" "),o("el-dialog",{attrs:{visible:e.showLinkListDialog,width:"90%",title:"关联标准类目","close-on-click-modal":!1,"before-close":e.cancelRelation},on:{"update:visible":function(t){e.showLinkListDialog=t}}},[o("el-row",[o("el-col",{attrs:{span:1}},[o("el-popover",{ref:"popover",attrs:{placement:"top-start",width:"200",trigger:"hover",content:"1. 一个营销叶子类目可关联多个标准类目；2. 选择标准一级类目时，则关联该一级类目下所有的二，三级类目；3. 发放某一营销类目优惠券时，将同时发放到所包含标准类目的所有商品"}},[o("el-button",{attrs:{slot:"reference",icon:"el-icon-info",size:"mini"},slot:"reference"},[e._v("规则")])],1)],1)],1),e._v(" "),o("el-row",{staticStyle:{margin:"20px 0","overflow-y":"scroll","max-height":"310px"}},[o("el-tree",{ref:"tree",attrs:{data:e.data2,"show-checkbox":"","node-key":"id","highlight-current":"",props:e.defaultProps,"render-after-expand":!0},on:{"check-change":e.checkChange}})],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:3}},[o("p",{staticStyle:{"font-size":"18px"}},[e._v("您当前选择的是：")])]),e._v(" "),o("el-col",{attrs:{span:21}},e._l(e.linkObj.linkArr,function(t,a){return o("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"item.show"}],key:a,staticStyle:{display:"inline-block",margin:"0 10px 10px 0"}},[o("el-tag",{attrs:{type:"info"}},[e._v(e._s(t.oneName)+"--"+e._s(t.twoName)+"--"+e._s(t.threeName))])],1)}))],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.cancelRelation}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.submitRelation}},[e._v("确 定")]),e._v(" "),o("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:e.submitRemoveCategoryButton}},[e._v("清除全部关联")])],1)],1)],1)},staticRenderFns:[]},u=o("VU/8")(d,g,!1,null,null,null);t.default=u.exports}});