webpackJsonp([86],{"9uZd":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("c/Tr"),a=s.n(i),r=s("Dd8w"),n=s.n(r),o=s("nv77"),l=s("E4LH"),c=s("NYxO"),u={name:"user",data:function(){var e=this,t=function(e,t,s){t||s(new Error("请输入邮箱地址!")),Object(l.b)(t)?s():s(new Error("请输入正确格式的邮箱地址!"))};return{listLoading:!0,listQuery:{name:void 0},typeList:[{name:"管理员",type:2},{name:"普通用户",type:3}],rules:{modifyUserName:[{required:!0,trigger:"blur",validator:function(t,s,i){var a=e.temp.userName;Object(l.d)(a)?i():i(new Error("用户名过短,用户名至少为三位"))}}],userName:[{required:!0,trigger:"blur",validator:t}],email:[{required:!0,trigger:"blur",validator:t}],password:[{required:!0,trigger:"blur",validator:function(e,t,s){void 0===t||t.length<6?s(new Error("密码不能小于6位数")):Object(l.c)(t)?s():s(new Error("1.最短6位，最长16位 2.必须包含1个数字 3.必须含有1个字母 3.必须包含1个特殊字符"))}}],newpasswd:[{required:!0,trigger:"blur",validator:function(t,s,i){s!==e.temp.password?i(new Error("二次密码不相同")):i()}}]},textMap:{create:"新建用户",modify:"修改信息",resetPassword:"重置密码",permission:"分配权限"},dialogStatus:"",createFormVisible:!1,modifyFormVisible:!1,resetPasswordFormVisible:!1,permissionFormVisible:!1,temp:{id:void 0,userName:void 0,passwd:void 0,email:void 0,newpasswd:void 0,role:void 0},tableKey:0,list:null,permissions:void 0,hasPermissions:void 0,defaultProps:void 0,currentPage:1,pageSize:20,totalPage:0,roles:[],defaultExpanded:[11e4,12e4,13e4],checkResult:[],userType:"",totalSize:0}},filters:{typeFilter:function(e){return{1:"超级管理员",2:"管理员",3:"普通用户"}[e]}},created:function(){this.fetchData()},computed:n()({},Object(c.b)(["menus"])),methods:{fetchData:function(){var e=this;this.listLoading=!0,Object(o.k)(this.listQuery,this.currentPage,this.pageSize).then(function(t){e.list=t.dataList,e.totalPage=t.totalPage,e.totalSize=t.totalSize,e.listLoading=!1}),Object(o.j)().then(function(t){e.roles=t.dataList})},resetTemp:function(){this.temp={id:void 0,userName:void 0,passwd:void 0}},createUser:function(){this.resetTemp(),this.dialogStatus="create",this.createFormVisible=!0},saveCreate:function(){var e=this;this.$refs.dataForm.validate(function(t){t&&(e.temp.type=3,Object(o.b)(e.temp).then(function(t){e.$notify({title:"添加成功",message:"密码已发送到"+e.temp.userName+"的邮箱,请提醒用户查收。",type:"success"}),e.createFormVisible=!1,e.fetchData()}))})},modifyUser:function(e){this.temp={id:e.id,userName:e.userName,email:e.email,phone:e.phone,type:e.type,role:[]},this.dialogStatus="modify",this.modifyFormVisible=!0},saveModify:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){if(e.temp.role){var s=[];e.temp.role.forEach(function(e,t){s.push({id:e})}),e.temp.roles=s}e.temp.type=e.userType,Object(o.q)(e.temp).then(function(t){e.$message({message:"修改成功",type:"success"}),e.userType="",e.fetchData(),e.modifyFormVisible=!1,e.createFormVisible=!1})}})},lockUser:function(e){var t=this;e.state=1===e.state?0:1,Object(o.m)({id:e.id,state:e.state}).then(function(s){t.$message({message:0===e.state?"解锁成功":"锁定成功",type:"success"})})},deleteUser:function(e){var t=this;this.$confirm("确定删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){Object(o.e)({id:e.id}).then(function(e){t.$message({message:"删除成功",type:"success"}),t.fetchData()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},resetPassword:function(e){var t=this;this.temp={id:e.id,password:void 0,newpasswd:void 0},this.dialogStatus="resetPassword",this.$confirm("确定重置该用户的密码?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.saveResetPassword()}).catch(function(){})},saveResetPassword:function(){var e=this;Object(o.r)(this.temp).then(function(t){e.$notify({title:"重置成功",message:"新密码已发送到该用户的邮箱,请提醒用户查收。",type:"success"}),e.resetPasswordFormVisible=!1})},grantPermission:function(e){var t=this;this.permissionFormVisible=!0,this.dialogStatus="permission",this.temp=e,this.temp.role=[],this.permissions=[],this.hasPermissions=[],this.checkResult=[];var s=this;Object(o.h)({id:e.id}).then(function(e){a()(e.dataList).forEach(function(e){s.checkResult.push(e.id)})}).then(function(e){Object(o.g)().then(function(e){t.permissions=e.dataList;for(var i=t.filterBaseId(t.permissions),a=0;a<s.checkResult.length;a++)for(var r=0;r<i.length;r++)s.checkResult[a]===i[r]&&s.hasPermissions.push(s.checkResult[a])})}),console.log(this.hasPermissions),this.defaultProps={children:"children",label:"name"}},filterBaseId:function(e){for(var t=[],s=0;s<e.length;s++)i(e[s]);function i(e){if(e.children)for(var s=0;s<e.children.length;s++)i(e.children[s]);else t.push(e.id)}return t},savePermission:function(){var e=this,t=[];a()(this.$refs.tree.getCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),a()(this.$refs.tree.getHalfCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),this.temp.menus=t,Object(o.d)(this.temp).then(function(t){e.$message({message:"分配权限成功",type:"success"}),e.permissionFormVisible=!1})},search:function(){var e=this;Object(o.k)(this.listQuery,this.currentPage,this.pageSize).then(function(t){e.list=t.dataList,e.currentPage=t.currentPage,e.pageSize=t.pageSize,e.totalSize=t.totalSize,e.listLoading=!1,e.$message({message:"查询成功",type:"success"})})},handleSizeChange:function(e){this.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.currentPage=e,this.fetchData()}}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"operation-container"},[s("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"请输入用户名"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.search(t)}},model:{value:e.listQuery.userName,callback:function(t){e.$set(e.listQuery,"userName",t)},expression:"listQuery.userName"}}),e._v(" "),s("el-select",{staticClass:"filter-item mr-10",staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"选择用户类型"},model:{value:e.listQuery.type,callback:function(t){e.$set(e.listQuery,"type",t)},expression:"listQuery.type"}},e._l(e.typeList,function(e){return s("el-option",{key:e.name,attrs:{label:e.name,value:e.type}})})),e._v(" "),s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.add"),expression:"menus.indexOf('account.user.add')!==-1"}],staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.createUser}},[e._v("添加")])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,"element-loading-text":"加载中",border:"",fit:"","highlight-current-row":""}},[s("el-table-column",{attrs:{align:"center",width:"65",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.$index+1))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"用户名","min-width":"110px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.userName))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"类型",width:"106px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:e._f("typeFilter")(t.row.type)}},[e._v(e._s(e._f("typeFilter")(t.row.type)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"角色","min-width":"96px"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,function(t){return s("el-tag",{key:t.name,attrs:{type:"success"}},[e._v(" "+e._s(t.name))])})}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"手机号",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.phone))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"邮箱","min-width":"110px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.email))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"创建时间",sortable:"",prop:"date","min-width":"122px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-time"}),e._v(" "),s("span",[e._v(e._s(t.row.createTime))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",align:"center",width:"410px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.modify"),expression:"menus.indexOf('account.user.modify')!==-1"}],attrs:{type:"primary",size:"small"},on:{click:function(s){e.modifyUser(t.row)}}},[e._v("编辑")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.resetPwd"),expression:"menus.indexOf('account.user.resetPwd')!==-1"}],attrs:{type:"success",size:"small"},on:{click:function(s){e.resetPassword(t.row)}}},[e._v("重置密码")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.grant"),expression:"menus.indexOf('account.user.grant')!==-1"}],attrs:{type:"danger",size:"small"},on:{click:function(s){e.grantPermission(t.row)}}},[e._v("用户权限")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.lock"),expression:"menus.indexOf('account.user.lock')!==-1"}],attrs:{type:"publish",size:"small"},on:{click:function(s){e.lockUser(t.row)}}},[e._v(e._s(1==t.row.state?"解锁":"锁定"))]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.delete"),expression:"menus.indexOf('account.user.delete')!==-1"}],attrs:{type:"danger",size:"small"},on:{click:function(s){e.deleteUser(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.createFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.createFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-form-item",{staticClass:"mb40",attrs:{label:"用户名",prop:"userName"}},[s("el-input",{attrs:{type:"text",placeholder:"请输入用户邮箱地址"},model:{value:e.temp.userName,callback:function(t){e.$set(e.temp,"userName","string"==typeof t?t.trim():t)},expression:"temp.userName"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.createFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveCreate()}}},[e._v("添加")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.modifyFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.modifyFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-form-item",{attrs:{label:"用户名",prop:"modifyUserName"}},[s("el-input",{attrs:{placeholder:"请输入用户名",type:"text"},model:{value:e.temp.userName,callback:function(t){e.$set(e.temp,"userName","string"==typeof t?t.trim():t)},expression:"temp.userName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[s("el-input",{attrs:{placeholder:"请输入手机号",type:"text"},model:{value:e.temp.phone,callback:function(t){e.$set(e.temp,"phone","string"==typeof t?t.trim():t)},expression:"temp.phone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{attrs:{placeholder:"请输入用户邮箱",type:"text"},model:{value:e.temp.email,callback:function(t){e.$set(e.temp,"email","string"==typeof t?t.trim():t)},expression:"temp.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"用户类型"}},[s("el-select",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"请选择用户类型"},model:{value:e.userType,callback:function(t){e.userType=t},expression:"userType"}},e._l(e.typeList,function(e){return s("el-option",{key:e.name,attrs:{label:e.name,value:e.type}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"用户角色"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择用户角色"},model:{value:e.temp.role,callback:function(t){e.$set(e.temp,"role",t)},expression:"temp.role"}},e._l(e.roles,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.modifyFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveModify()}}},[e._v("更新")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.resetPasswordFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.resetPasswordFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-form-item",{staticClass:"mb40",attrs:{label:"新设密码",prop:"password"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.password,callback:function(t){e.$set(e.temp,"password","string"==typeof t?t.trim():t)},expression:"temp.password"}})],1),e._v(" "),s("el-form-item",{staticClass:"mb40",attrs:{label:"重复密码",prop:"newpasswd"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.newpasswd,callback:function(t){e.$set(e.temp,"newpasswd","string"==typeof t?t.trim():t)},expression:"temp.newpasswd"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.resetPasswordFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveResetPassword()}}},[e._v("重置")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.permissionFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.permissionFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"5%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-tree",{ref:"tree",attrs:{data:e.permissions,"show-checkbox":"","node-key":"id","default-expanded-keys":e.defaultExpanded,"default-checked-keys":e.hasPermissions,"highlight-current":"",props:e.defaultProps}})],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.permissionFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.savePermission()}}},[e._v("分配")])],1)],1),e._v(" "),[s("div",{staticClass:"block pagination-container"},[s("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalSize},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]],2)},staticRenderFns:[]};var d=s("VU/8")(u,m,!1,function(e){s("bLWp")},null,null);t.default=d.exports},bLWp:function(e,t){}});