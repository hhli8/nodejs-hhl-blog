webpackJsonp([42],{O2yo:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),o=a("PIXF"),n=a("Cdw0"),l=a("sjfE"),c=a("TIfe"),r={name:"alipayactivity",components:{uploadImg:l.a},mixins:[n.a],data:function(){return{multipleQueryGoodsTable:[],activityName:"",time:"",activityImg:"",goodsParam:{},shelvesData:"",goodsSort:1,pageSize:10,activityId:1,tabledata:[],activitydata:[],shelvesArr:[],showType:2,bannerIndexArr:[],uploadUrl:"https://www.xiaoxiangyoupin.com/xxyp-manager/upload/uploadPic",uploadMsg:"https://www.xiaoxiangyoupin.com/xxyp-manager/mp/activity/uploadActivityGoods",dialogFormVisible:!1,visible:!1,id:1,name:""}},computed:{uploadHeader:function(){return{Token:Object(c.c)()}}},created:function(){this.getSelectList()},methods:{getData:function(){var t=this,e={activityId:this.activityId,pageNum:this.currentPage,pageSize:this.pageSize};Object(o.j)(e).then(function(e){t.totalSize=e.data.total,t.tabledata=e.data.list})},getSelectList:function(){var t=this;Object(o.e)({id:2}).then(function(e){t.shelvesArr=e.data,t.activityType=e.data[0].activityType,t.activityId=e.data[0].id,t.shelvesData=e.data[0].activityName,t.activityName=e.data[0].activityName,t.time=[e.data[0].startTime,e.data[0].endTime],t.activityImg=e.data[0].activityImg,t.getData()})},demove:function(t,e){var a=this;this.$confirm("你确定要删除当前数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){var t={ids:[]};t.ids.push(e.id),Object(o.b)(t).then(function(){a.getData(),a.$message({type:"success",message:"删除成功!"})})}).catch(function(t){a.deleteCancel(t)})},deleteCancel:function(t){this.$message({type:"info",message:"取消删除"})},alertMessage:function(t,e){this.$message({type:t,message:e})},addActivity:function(){this.dialogFormVisible=!0},cancelBtn:function(){this.dialogFormVisible=!1,this.visible=!1},addData:function(){this.visible=!0,this.tabledata.unshift({activityId:this.activityId,goodsSort:this.goodsSort,status:1})},trueBtn:function(){var t=this,e={activityGoodsDTOs:[]};this.goodsParam.activityId=this.activityId,this.goodsParam.status=1,e.activityGoodsDTOs.push(this.goodsParam),Object(o.f)(e).then(function(e){t.getData(),t.$message({type:"success",message:e.message})}).catch(),this.visible=!1},confirmBtn:function(t){var e=this;Object(o.g)({id:t,activityType:2,activityName:this.name,activityImg:this.activityImg,startTime:this.time[0],endTime:this.time[1],status:1}).then(function(t){e.getSelectList(),e.dialogFormVisible=!1})},issueGoods:function(){var t=this,e={};e.activityGoodsDTOs=JSON.parse(s()(t.tabledata)),this.confirmBtn(this.activityId),Object(o.f)(e).then(function(e){t.$message({type:"success",message:e.message})}).catch()},deleteActivityModule:function(){var t=this,e={id:t.activityId};Object(o.a)(e).then(function(){t.$message({type:"success",message:"活动删除成功"}),t.getSelectList()}).catch()},changeVal:function(t){var e={};this.shelvesArr.filter(function(a){t===a.id&&(e=a)}),this.activityId=e.id,this.activityName=e.activityName,this.time=[e.startTime,e.endTime],this.activityImg=e.activityImg,this.getData()},uploadSuccess:function(t){this.activityImg=t.data,this.alertMessage("success","图片上传成功")},handleAvatarSuccessAdd:function(t){this.$message({type:"success",message:"上传成功"}),this.getData()},handleSizeChange:function(t){this.pageSize=t,this.getSelectList()},handleCurrentChange:function(t){this.currentPage=t,this.getSelectList()},handleSelectionChangeGoods:function(t){this.multipleQueryGoodsTable=t},deleteAll:function(){for(var t=this,e={ids:[]},a=0;a<t.multipleQueryGoodsTable.length;a++)e.ids.push(t.multipleQueryGoodsTable[a].id);Object(o.b)(e).then(function(e){t.$message({type:"success",message:e.message}),t.getData()}).catch()}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"alipayLottery"},[a("div",[a("el-form",{ref:"form",staticClass:"header-form"},[a("el-form-item",{attrs:{label:"活动模块:"}},[a("el-select",{attrs:{placeholder:"请选择活动区域"},on:{change:t.changeVal},model:{value:t.shelvesData,callback:function(e){t.shelvesData=e},expression:"shelvesData"}},t._l(t.shelvesArr,function(t){return a("el-option",{key:t.id,attrs:{label:t.activityName,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"活动时间:"}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["12:00:00"]},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"头部图片:"}},[a("uploadImg",{attrs:{"upload-url":t.uploadUrl,"handle-avatar-success":t.uploadSuccess,"img-url":t.activityImg}},[a("el-button",{staticClass:"uploadButton",attrs:{size:"small",plain:"",icon:"el-icon-upload2"}},[t._v("重新上传")])],1)],1)],1)],1),t._v(" "),a("section",[a("div",{staticClass:"grid-content bg-purple btn-right"},[a("el-upload",{staticClass:"avatar-uploader",attrs:{headers:t.uploadHeader,data:{activityId:this.activityId},action:t.uploadMsg,"show-file-list":!1,"on-success":t.handleAvatarSuccessAdd}},[a("el-button",{attrs:{plain:"",icon:"el-icon-upload2"}},[t._v("上传")])],1),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:t.issueGoods}},[t._v("发布")]),t._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:t.addActivity}},[t._v("新增活动")]),t._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:t.addData}},[t._v("新增商品")]),t._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:t.deleteActivityModule}},[t._v("删除活动")]),t._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:t.deleteAll}},[t._v("批量删除")])],1)]),t._v(" "),a("el-table",{ref:"multipleQueryGoodsTable",staticClass:"lists",attrs:{border:"",data:t.tabledata,"empty-text":"暂无数据"},on:{"selection-change":t.handleSelectionChangeGoods}},[a("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"*商品标题",align:"center","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"price",label:"*商品价格",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s((e.row.price/100).toFixed(2)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"img",label:"*商品图片",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.row.img,fit:"contain"},on:{click:function(a){t.$store.dispatch("openImgPreview",{url:e.row.img})}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"goodsSort",label:"*商品顺序",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{clearable:""},model:{value:e.row.goodsSort,callback:function(a){t.$set(e.row,"goodsSort",a)},expression:"scope.row.goodsSort"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.demove(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalSize>0,expression:"totalSize>0"}],staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalSize},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{visible:t.visible,center:"",width:"35%"},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{staticStyle:{width:"80%","margin-left":"8%"}},[a("el-form-item",{attrs:{label:"新增活动商品id"}},[a("el-input",{staticStyle:{width:"200px"},model:{value:t.goodsParam.skuId,callback:function(e){t.$set(t.goodsParam,"skuId",e)},expression:"goodsParam.skuId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"选品序号"}},[a("el-input",{staticStyle:{width:"200px"},model:{value:t.goodsParam.goodsSort,callback:function(e){t.$set(t.goodsParam,"goodsSort",e)},expression:"goodsParam.goodsSort"}})],1),t._v(" "),a("div",{staticClass:"oBtn"},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.trueBtn}},[t._v("确定")]),t._v(" "),a("el-button",{attrs:{size:"medium",type:"warning"},on:{click:t.cancelBtn}},[t._v("取消")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogFormVisible,center:"",width:"35%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{staticStyle:{width:"80%","margin-left":"8%"}},[a("el-form-item",{attrs:{label:"活动名"}},[a("el-input",{staticStyle:{width:"200px"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),a("div",{staticClass:"oBtn"},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(){return t.confirmBtn(void 0)}}},[t._v("确定")]),t._v(" "),a("el-button",{attrs:{size:"medium",type:"warning"},on:{click:t.cancelBtn}},[t._v("取消")])],1)],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(r,d,!1,function(t){a("w6dC"),a("zoGL")},"data-v-14275cb2",null);e.default=u.exports},w6dC:function(t,e){},zoGL:function(t,e){}});