webpackJsonp([26],{"2UfB":function(e,t,o){"use strict";var l=o("TIfe"),a=this,s={name:"uploadImg",props:{uploadUrl:{type:String,default:"https://www.xiaoxiangyoupin.com/xxyp-manager/upload/uploadPic"},handleAvatarSuccess:{type:Function,required:!0},onUploadError:{type:Function,default:function(){a.alertMessage("error","上传图片失败，请重新上传")}},imgUrl:{type:String,required:!0},maxWidth:{type:String,default:"160px"}},computed:{uploadHeader:function(){return{Token:Object(l.c)()}}},alertMessage:function(e,t){this.$message({type:e,message:t})}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"upload-img"},[o("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,headers:e.uploadHeader,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"on-error":e.onUploadError}},[o("div",{staticClass:"upload-area"},[e.imgUrl?o("img",{staticClass:"avatar firstImg",style:{maxWidth:e.maxWidth},attrs:{src:e.imgUrl}}):o("div",{staticClass:"noImgDisplay",style:{width:e.maxWidth}},[e._v("\n        请点击上传按钮"),o("br"),e._v("上传图片\n      ")]),e._v(" "),e._t("default")],2)])],1)},staticRenderFns:[]};var i=o("VU/8")(s,n,!1,function(e){o("IvGY")},"data-v-0513a2e8",null);t.a=i.exports},"68td":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o("woOf"),a=o.n(l),s=o("o+mB"),n={name:"getRedPackets",data:function(){return{tableData:[],currentPage:1,totalSize:0,pageSize:10,lookTaskVisible:!1,title:"",form:{imgUrl:"",icon:"",title:"",link:"",couponAmount:"",start:"",end:"",benefitRole:"",flag:"",type:"",ruleId:7,status:1},count:0,enjoyPeoples:[{label:"买手实习生",value:3},{label:"买手",value:1},{label:"体验买手",value:2}],flagLists:[{label:"是",value:1},{label:"否",value:0}],type:[{label:"邀新",value:1},{label:"下单",value:2}],isModify:!0,ruleListId:"",ruleList:[],taskRuleVisible:!1,form1:{type:"",title:"",personHigh:"",personLower:"",amountHigh:"",amountLower:""},ruleTypeList:[{label:"邀新",value:1},{label:"下单",value:2},{label:"自己首单",value:3},{label:"粉丝首单",value:4},{label:"自己下单",value:5},{label:"粉丝下单",value:6}],lookRule:!0,couponVisible:!1,couponTableData:[],loading:!1,couponId:void 0}},created:function(){this.initData()},components:{uploadImg:o("2UfB").a},methods:{onAddCoupon:function(){this.couponTableData.push({couponCode:"",couponName:"",isEdit:!0})},onSaveCoupon:function(e){var t=this;Object(s.o)({ruleId:this.couponId,couponCode:e.couponCode}).then(function(e){e.data?(t.alertMessage("success","保存成功"),t.getCouponsList(t.couponId)):t.alertMessage("error","保存失败，优惠券ID已存在或配置有误")})},onRemoveCoupon:function(e){var t=this;this.$confirm("你确定要删除吗？","确认消息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.d)({id:e.id}).then(function(e){t.alertMessage("success","删除成功"),t.getCouponsList(t.couponId)})}).catch(function(){t.alertMessage("info","已取消")})},btnType:function(e){var t="success";return 1===e&&(t="warning"),t},onToggleStatus:function(e,t){1===t.status?t.status=0:t.status=1,this.updateTaskList(t)},resetFormData:function(){this.form={imgUrl:"",icon:"",title:"",link:"",couponAmount:"",start:"",end:"",benefitRole:"",flag:"",type:"",ruleId:"",status:1}},resetRuleForm:function(){this.form1={type:"",title:"",personHigh:"",personLower:"",amountHigh:"",amountLower:""}},resetRuleTypeList:function(){this.ruleTypeList=[{label:"邀新",value:1},{label:"下单",value:2},{label:"自己首单",value:3},{label:"粉丝首单",value:4},{label:"自己下单",value:5},{label:"粉丝下单",value:6}]},changeFlag:function(e){this.form.flag=e},changeRoleType:function(e){this.form.type=e,console.log(this.form.type)},changeRule:function(e){this.form.ruleId=e},onCoupon:function(e){this.couponId=e.id,this.getCouponsList(e.id),this.couponVisible=!0},getCouponsList:function(e){var t=this;this.loading=!0,Object(s.i)({ruleId:e}).then(function(e){t.couponTableData=e.data,t.couponTableData.forEach(function(e){e.disabled=!0}),t.loading=!1})},onRemove:function(e){var t=this;this.$confirm("你确定要删除吗？","确认消息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.f)({id:e}).then(function(e){t.getTaskLists(),t.alertMessage("success","删除成功")})}).catch(function(){t.alertMessage("info","已取消")})},closeLookTask:function(){this.resetFormData()},closeCoupon:function(){this.couponTableData=[]},closeRule:function(){this.resetRuleForm(),this.resetRuleTypeList()},changeBenefitRole:function(e){this.form.benefitRole=e},changeRuleType:function(e){this.form1.type=e},onRelease:function(){var e=this;Object(s.q)().then(function(){e.alertMessage("success","发布成功")})},initData:function(){this.getTaskLists(),this.getTaskRule()},onAddNewTask:function(){this.isModify=!1,this.lookTaskVisible=!0},onSaveAddRule:function(){var e=this;Object(s.b)(this.form1).then(function(t){e.getTaskRule(),e.alertMessage("success","新增规则保存成功"),e.taskRuleVisible=!1})},onLookRule:function(e){var t=this;this.form.type&&this.form.ruleId?(1===this.form.type?(this.ruleTypeList=this.ruleTypeList.slice(0,1),console.log(this.ruleTypeList)):(console.log("222"),this.ruleTypeList=this.ruleTypeList.slice(1),console.log(this.ruleTypeList)),this.taskRuleVisible=!0,this.lookRule=1===e,console.log(this.ruleList),console.log(this.form.ruleId),1===e?this.form1=this.ruleList.filter(function(e){return e.id===Number(t.form.ruleId)})[0]:this.resetRuleForm()):this.alertMessage("error","请先选择规则内容和任务类型")},onSaveTask:function(){var e=this;this.form.icon=this.form.imgUrl,this.form.ruleId=String(this.form.ruleId),this.isModify?this.updateTaskList(this.form):Object(s.a)(this.form).then(function(t){e.saveSuccess(1)})},updateTaskList:function(e){var t=this;Object(s.s)(e).then(function(e){t.saveSuccess(2)})},saveSuccess:function(e){this.lookTaskVisible=!1,this.getTaskLists();var t=1===e?"保存成功":"修改成功";this.alertMessage("success",t)},handleAvatarSuccess:function(e){this.form.imgUrl=e.data,this.count++,this.alertMessage("success","图片上传成功")},alertMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"success",t=arguments[1];this.$message({type:e,message:t})},getTaskLists:function(){var e=this;Object(s.l)({title:this.title,pageSize:this.pageSize,pageNum:this.currentPage}).then(function(t){e.tableData=t.dataList,e.totalSize=t.totalSize})},getTaskRule:function(){var e=this;Object(s.m)({title:this.title,id:this.ruleListId,pageSize:1e3,pageNum:this.pageNum}).then(function(t){e.ruleList=t.dataList})},onLookCurrentTask:function(e,t,o){e.ruleId=Number(e.ruleId),this.isModify=!0,a()(this.form,e),this.form.imgUrl=this.form.icon,this.lookTaskVisible=!0},handleSizeChange:function(e){this.pageSize=e,this.getTaskLists()},handleCurrentChange:function(e){this.currentPage=e,this.getTaskLists()}}},i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"getRedPackets app-container"},[o("div",{staticClass:"margin"},[o("el-button",{attrs:{type:"primary"},on:{click:e.onAddNewTask}},[e._v("新增任务")]),e._v(" "),o("el-button",{attrs:{type:"success"},on:{click:e.onRelease}},[e._v("发布")])],1),e._v(" "),o("el-table",{attrs:{data:e.tableData},on:{"row-dblclick":e.onLookCurrentTask}},[o("el-table-column",{attrs:{prop:"",label:"icon图片",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[o("div",{staticClass:"img-box"},[o("div",{staticClass:"icon-bg",style:{backgroundImage:"url("+e.row.icon+")"}})])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"title",label:"title描述",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"link",label:"跳转链接",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:e.btnType(t.row.status)},on:{click:function(o){e.onToggleStatus(t.$index,t.row)}}},[e._v("\n          "+e._s(1===t.row.status?"禁用":"启用")+"\n        ")]),e._v(" "),o("el-button",{attrs:{type:"danger"},on:{click:function(o){e.onRemove(t.row.id)}}},[e._v("删除")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(o){e.onCoupon(t.row)}}},[e._v("优惠券配置")])]}}])})],1),e._v(" "),o("el-pagination",{staticClass:"pagination other-pagination",attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalSize},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),o("el-dialog",{attrs:{title:e.isModify?"查看任务":"新增任务",visible:e.lookTaskVisible},on:{"update:visible":function(t){e.lookTaskVisible=t},close:e.closeLookTask}},[o("el-form",{attrs:{model:e.form}},[o("el-form-item",[o("el-select",{key:e.count,attrs:{placeholder:"规则内容",filterable:"",clearable:""},on:{change:e.changeRule},model:{value:e.form.ruleId,callback:function(t){e.$set(e.form,"ruleId",t)},expression:"form.ruleId"}},e._l(e.ruleList,function(e){return o("el-option",{key:e.id,attrs:{value:e.id,label:e.title}})})),e._v(" "),o("el-select",{attrs:{placeholder:"任务类型"},on:{change:e.changeRoleType},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.type,function(e){return o("el-option",{key:e.label,attrs:{value:e.value,label:e.label}})})),e._v(" "),e.isModify?o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onLookRule(1)}}},[e._v("查看规则")]):o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onLookRule(2)}}},[e._v("新增规则")])],1),e._v(" "),o("el-form-item",{attrs:{label:"返现金额(分)","label-width":"96px"}},[o("el-input",{staticStyle:{width:"120px"},model:{value:e.form.couponAmount,callback:function(t){e.$set(e.form,"couponAmount",t)},expression:"form.couponAmount"}})],1),e._v(" "),o("el-form-item",[o("el-select",{attrs:{placeholder:"享受人群"},on:{change:e.changeBenefitRole},model:{value:e.form.benefitRole,callback:function(t){e.$set(e.form,"benefitRole",t)},expression:"form.benefitRole"}},e._l(e.enjoyPeoples,function(e,t){return o("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),o("el-form-item",[o("el-select",{attrs:{placeholder:"是否升级角色"},on:{change:e.changeFlag},model:{value:e.form.flag,callback:function(t){e.$set(e.form,"flag",t)},expression:"form.flag"}},e._l(e.flagLists,function(e){return o("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),o("el-form-item",[o("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"开始时间"},model:{value:e.form.start,callback:function(t){e.$set(e.form,"start",t)},expression:"form.start"}}),e._v("\n        -\n        "),o("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"结束时间"},model:{value:e.form.end,callback:function(t){e.$set(e.form,"end",t)},expression:"form.end"}})],1),e._v(" "),o("el-form-item",{key:e.count},[o("uploadImg",{attrs:{"handle-avatar-success":e.handleAvatarSuccess,"img-url":e.form.imgUrl}},[o("el-button",{staticClass:"uploadButton",attrs:{size:"small",type:"primary"}},[e._v(e._s(e.form.imgUrl?"重新上传":"上传icon"))])],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"跳转链接","label-width":"76px"}},[o("el-input",{model:{value:e.form.link,callback:function(t){e.$set(e.form,"link",t)},expression:"form.link"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"title描述","label-width":"76px"}},[o("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.lookTaskVisible=!1}}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.onSaveTask}},[e._v("保存")])],1),e._v(" "),o("el-dialog",{attrs:{width:"50%",visible:e.taskRuleVisible,"append-to-body":"",title:e.isModify?"查看规则":"新增规则"},on:{"update:visible":function(t){e.taskRuleVisible=t},close:e.closeRule}},[o("el-select",{staticClass:"line",attrs:{disabled:e.lookRule},on:{change:e.changeRuleType},model:{value:e.form1.type,callback:function(t){e.$set(e.form1,"type",t)},expression:"form1.type"}},e._l(e.ruleTypeList,function(e){return o("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),e._v(" "),o("el-input",{staticClass:"line",attrs:{disabled:e.lookRule},model:{value:e.form1.title,callback:function(t){e.$set(e.form1,"title",t)},expression:"form1.title"}}),e._v(" "),o("el-row",{staticClass:"line",attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("label",{attrs:{for:""}},[e._v("人数上限")]),e._v(" "),o("el-input",{attrs:{disabled:e.lookRule},model:{value:e.form1.personHigh,callback:function(t){e.$set(e.form1,"personHigh",t)},expression:"form1.personHigh"}})],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("label",{attrs:{for:""}},[e._v("人数下限")]),e._v(" "),o("el-input",{attrs:{disabled:e.lookRule},model:{value:e.form1.personLower,callback:function(t){e.$set(e.form1,"personLower",t)},expression:"form1.personLower"}})],1)],1),e._v(" "),o("el-row",{staticClass:"line",attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("label",{attrs:{for:""}},[e._v("下单金额上限")]),e._v(" "),o("el-input",{attrs:{disabled:e.lookRule},model:{value:e.form1.amountHigh,callback:function(t){e.$set(e.form1,"amountHigh",t)},expression:"form1.amountHigh"}})],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("label",{attrs:{for:""}},[e._v("下单金额下限")]),e._v(" "),o("el-input",{attrs:{disabled:e.lookRule},model:{value:e.form1.amountLower,callback:function(t){e.$set(e.form1,"amountLower",t)},expression:"form1.amountLower"}})],1)],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.lookRule,expression:"!lookRule"}],staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.taskRuleVisible=!1}}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.onSaveAddRule}},[e._v("保存")])],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{visible:e.couponVisible,title:"优惠券配置"},on:{"update:visible":function(t){e.couponVisible=t},close:e.closeCoupon}},[o("el-button",{attrs:{type:"primary"},on:{click:e.onAddCoupon}},[e._v("新增")]),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.couponTableData}},[o("el-table-column",{attrs:{prop:"",label:"优惠券ID",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{disabled:t.row.disabled,clearable:""},model:{value:t.row.couponCode,callback:function(o){e.$set(t.row,"couponCode",o)},expression:"scope.row.couponCode"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"",label:"优惠券名字",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{disabled:""},model:{value:t.row.couponName,callback:function(o){e.$set(t.row,"couponName",o)},expression:"scope.row.couponName"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"danger"},on:{click:function(o){e.onRemoveCoupon(t.row)}}},[e._v("删除")]),e._v(" "),t.row.id?e._e():o("el-button",{attrs:{type:"primary"},on:{click:function(o){e.onSaveCoupon(t.row)}}},[e._v("保存")])]}}])})],1)],1)],1)},staticRenderFns:[]};var r=o("VU/8")(n,i,!1,function(e){o("eqzp")},"data-v-f64954cc",null);t.default=r.exports},IvGY:function(e,t){},eqzp:function(e,t){}});