webpackJsonp([32],{MyDU:function(e,t){},b9qX:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),s=a("PIXF"),n=a("Cdw0"),l=a("sjfE"),o=a("TIfe"),c={name:"banner",components:{uploadImg:l.a},mixins:[n.a],data:function(){return{num:0,activityParam:{startTime:"",endTime:""},pageSize:10,pageNum:1,activityName:"",activityConsumeGold:"",activityId:1,tabledata:[],shelvesArr:[],shelvesData:"首页轮播",showType:2,type:4,bannerIndexArr:[],uploadUrl:"https://www.xiaoxiangyoupin.com/xxyp-manager/upload/uploadPic",currentIndex:0,name:"",startTime:"",endTime:"",totalSize:0,currentRowIndex:0}},computed:{uploadHeader:function(){return{Token:Object(o.c)()}}},created:function(){this.getActivityList()},methods:{getData:function(){var e=this,t={activityId:this.activityId,pageNum:this.pageNum,pageSize:this.pageSize};Object(s.l)(t).then(function(t){e.tabledata=t.data.list,e.totalSize=t.data.total})},btnType:function(e){var t="success";return 1===e&&(t="warning"),t},uploadImgDisplay:function(e){this.currentIndex=e},getActivityList:function(){var e=this;Object(s.e)({id:1}).then(function(t){e.shelvesArr=t.data,e.activityParam.activityName=e.shelvesArr[0].activityName,e.activityParam.activityConsumeGold=e.shelvesArr[0].activityConsumeGold,e.activityParam.startTime=e.shelvesArr[0].startTime,e.activityParam.endTime=e.shelvesArr[0].endTime,e.activityParam.activityId=e.shelvesArr[0].id,e.activityParam.id=e.shelvesArr[0].id,e.activityId=e.shelvesArr[0].id,e.getData()})},saveStateDelete:function(){var e=this;this.$confirm("你确定要删除当前数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){e.deleteConfirm()}).catch(function(t){e.deleteCancel(t)})},demove:function(e,t){this.row=t,this.row.id?this.saveStateDelete():this.tabledata.splice(e,1)},deleteConfirm:function(){var e=this;Object(s.d)({id:this.row.id}).then(function(){e.getData(),e.$message({type:"success",message:"删除成功!"})})},deleteCancel:function(e){this.$message({type:"info",message:"取消删除"})},alertMessage:function(e,t){this.$message({type:e,message:t})},addData:function(){this.activityId?this.tabledata.length>=8?this.$message({type:"error",message:"奖品至多8个"}):this.tabledata.unshift({activityId:this.activityId,status:1}):this.$message({type:"error",message:"暂无可用活动，请刷新页面重试"})},handleAvatarSuccess:function(e){this.dataNow.prizeImg=e.data,this.$set(this.tabledata,this.currentRowIndex,this.dataNow),this.$message({type:"success",message:"上传成功"})},handleSizeChange:function(e){this.pageSize=e,this.getData()},publishPrize:function(){var e=this,t=this;t.num=0;var a={};if(8===t.tabledata.length){for(var i=JSON.parse(r()(t.tabledata)),n=0;n<i.length;n++)"string"==typeof i[n].prizeProbability&&(i[n].prizeProbability=JSON.parse(i[n].prizeProbability));for(var l=0;l<i.length;l++)t.num=t.num+i[l].prizeProbability,console.log(t.num+"-----"+i[l].prizeProbability);if(t.num>1)t.$message({type:"error",message:"奖品总概率不能大于1"});else{var o=JSON.parse(r()(this.activityParam));Object(s.g)(o).then(function(e){t.getActivityList()}).catch(function(e){t.$message({type:"error",message:e.message})}),a.activityLotteryPrizeDTOs=JSON.parse(r()(t.tabledata)),Object(s.i)(a).then(function(){e.$message({type:"success",message:"发布成功!"}),e.getData()})}}else t.$message({type:"error",message:"奖品只能有8个！"})},upLoad:function(e,t,a){this.dataNow=e,this.currentRowIndex=t}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"alipayLottery"},[a("div",[a("el-row",{attrs:{gutter:20}},[a("el-form",{ref:"form",staticClass:"header-form"},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"单次抽奖金币额度:"}},[a("el-input",{staticStyle:{width:"160px"},model:{value:e.activityParam.activityConsumeGold,callback:function(t){e.$set(e.activityParam,"activityConsumeGold",t)},expression:"activityParam.activityConsumeGold"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"活动时间:"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期时间"},model:{value:e.activityParam.startTime,callback:function(t){e.$set(e.activityParam,"startTime",t)},expression:"activityParam.startTime"}}),e._v(" "),a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.activityParam.endTime,callback:function(t){e.$set(e.activityParam,"endTime",t)},expression:"activityParam.endTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"活动名称:"}},[a("el-input",{staticStyle:{width:"200px"},model:{value:e.activityParam.activityName,callback:function(t){e.$set(e.activityParam,"activityName",t)},expression:"activityParam.activityName"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"grid-content bg-purple btn-right"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.publishPrize}},[e._v("发布")]),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.addData}},[e._v("新增")])],1)],1),e._v(" "),a("el-table",{staticClass:"lists",attrs:{border:"",data:e.tabledata,"empty-text":"暂无数据"}},[a("el-table-column",{attrs:{prop:"prizeImg",label:"*奖品图片",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.row.prizeImg,fit:"contain"},on:{click:function(a){e.$store.dispatch("openImgPreview",{url:t.row.prizeImg})}}}),e._v(" "),a("el-upload",{staticClass:"upload-demo",attrs:{headers:e.uploadHeader,action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){e.upLoad(t.row,t.$index)}}},[e._v("重新上传")])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"prizeName",label:"*奖品标题",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"商品标题",clearable:""},model:{value:t.row.prizeName,callback:function(a){e.$set(t.row,"prizeName",a)},expression:"scope.row.prizeName"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"prizeSort",label:"*奖品顺序",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"商品顺序",clearable:""},model:{value:t.row.prizeSort,callback:function(a){e.$set(t.row,"prizeSort",a)},expression:"scope.row.prizeSort"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"prizeLimit",label:"*每日奖品数量上限",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"每日奖品数量上限",clearable:""},model:{value:t.row.prizeLimit,callback:function(a){e.$set(t.row,"prizeLimit",a)},expression:"scope.row.prizeLimit"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"prizeProbability",label:"*概率",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"概率",clearable:""},model:{value:t.row.prizeProbability,callback:function(a){e.$set(t.row,"prizeProbability",a)},expression:"scope.row.prizeProbability"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.demove(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.totalSize>0,expression:"totalSize>0"}],staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,40,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalSize},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var p=a("VU/8")(c,u,!1,function(e){a("w8nj"),a("MyDU")},"data-v-cf89289a",null);t.default=p.exports},w8nj:function(e,t){}});