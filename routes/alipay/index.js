const express = require('express')
const router = express.Router()

const AlipaySdk = require('alipay-sdk').default
const AlipaySdkForm = require('alipay-sdk/lib/form').default
const fs = require("fs")
const path = require("path")

router.get('/sign', async (req, res) => {
  const alipay = new AlipaySdk({
    appId: '2016101800717286',
    // privateKey: 'MIIEowIBAAKCAQEA1KfYR6uo8Du7Zp8dP5RmiQCApaH1hBOKAguJiFOJmMooMIoE93EYHpGEkJgztBCCByTNatnoZRfq6T1jZTvklKCiAfHK7BW2pip+S+3Ob15FfDpsf0/GWOR7/IFL7vTLp0RwsOzZpz8ZiM3S1YxRAMwkLv8jr970VJH/aySYBGwJYxY/LP+KEjty3NMMjDJWF4nzxkGefoSACVAAa9A2yw4bviXlexojOle7xCbDeFwL0SNw028tdRkiTiN5SXNz3zOGNz7vbMEO+oXPd/kjLDeFBGbyuRPTf8Mx4fqSxI6PphLmELClPOT/XJhF6F4L8aJq9OCju40hbgJa8wc8/wIDAQABAoIBAQCOBb7bNtjwAGSLB+8nvDuyeeRxOjZXTBlafkwPAQOfSDwJFtR0UVKzb6oiS5QUSQYeMUUDfJ7JjWy08uvD+3kQjitEszA79dBzL2QD38GD/WjYq8g0SpoEWiw4Gj4VS+YLQxkkADroiKrMA/Iv7rNWnf/4Zyt1VKjHJm54Jwtjv26qCZ+h08IDJ/brUW9G07nu5nMlgWAXRFKqy6iza0C4yLwS09lpfLZZ1MvUGeIZme8+WXKsVQE0+dDa99joJbrZaenjlyfq3ocr8v/Kx0s7aUpCHDnKBosEB/U/xCiPWxYz0kXmgpQmzotNHYtbYGqlQUxd5P6q3+sbwLpzcBkhAoGBAP8puZhqOf2dKib4POEx7dTkI0SBc4z8ZGhKX90+H3tkjEdxHO7fO2+EUWDPCOEneTTq+acVpMpslQjMikHKwE1hL/32LE5LXBskwjECgMAbeHsFehJmrctAhm5U2lrr9vpXzYBv2qptHD4IYHvwycyUiaUgt8+XochwEYjBXq9vAoGBANVabIt2ICSd25vr7kSGUke81geX1S1Z4fFe3711wrjula/mZi/2CqDK5I57H09cHCLVYnOzHMVpZBnyOHiWVNlHvMzD3wcNk2F2uvtPr5m1G9Dohu5Dn1DkiG9mKf1fKNlLNBd9BrJ1ajCSK5XcHTF5dtY42JKiLoQwG4pH6oNxAoGADIVvphsQXXGo7+CenC5nDVtkn6f6k6CPDM8ZhTHXOable1wBn3c043QKykVemi3ltMMTHS/itkw9xADFiBT6+tEaGcxKwEzSaEKVhPIqf0LZ1q+eHekL/j1cW22uiWeq5v4IB5V1lYdlK2Yd1fcq7+8aEhBY9MbsGXnmYl+a1eECgYAX56THz3l0gNdtVfcBaIdpkEfu290/0pVVRQsOoFYsAFd3OPp0Hz47m+AV8sekTa69XGlGi2gK2m8j1Rbss/NX0QjfbIbdtHCx9+qlY91J/JfcRWFw6tS77I845BqKUBI0no98nj6U2kEGpioKBXqj43ckM4RYkaFioD1Fth8ZkQKBgBVqrX1nmvyihTbR0Y5Ss2TinyCilZdr+m96ZvNlXWkwrl7VMCMNWrf1Ne4Kzjh1kwuT3GhrffNHRql2c2QfGtnZ4Ss5gyhz/oEv4CTqI/UNhtRxCix9zZ9+PUuj/rlC8u/hC03EirxKIkW9H7jeYurmn+VZHObvDg+ZUsOPSuMD',
    // privateKey: 'MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDEHvevQZ0fRI1jNY7uEeta3wTcboXhsGm0nrJCcn3TSKC4R+RzesITRA12RrbaJSl+Kq3QLLJrpA+9oorKGTlRjA3auI5adFa54sV5D5oQQ1cWUwSEI4l+NmIMbx9ghvdKpMtvxaOM3tAMVJObuAycj6pMOyatjAPJmzaU3WTG+gq4J7mfKVKZhqu+5sysSZ8RuElKsP/FsMOGONWEmiSB/ejfTSmjDqwneQbIf7r0dvP9guUXKkeCZgxNJeCm5+tARlW7D3WA5BoROe1bBL9ObHLGiuJ/8HtMuEMQjzUEixtiK44yRRA01thaq3qp40dNYsK/okLj3JPdaQLBNKhfAgMBAAECggEAL6HJzDHmZEq1ACxo219Uxww1VQgu0gKTmb+VUdgWwTL5fehQDs/4xM8ZaemAzXiLHE5nSpEggE4nWIpapPz9U9XtI3sBb+yjh6ARD/b/FwYT56MgDKvI3/N7WsO+XiZJd0KQ+kOJFlSjOOttsjtALOIjnUIcgbfoz5U3623d5Qk2lsMjAOtXAfgwRp0qFmyxPou2BmHoN/VHbxTxZzY7glFuPXxTE7mDpi2g+CEb8bZS3jClK9YsWHfkvpWHEmf4inXLn7fbNdAoJVB5zdBitZhazn3q1DdGtdCKJKhbHYsDNQzJyDuc1/gF3ZaeW+B9gDyBIIWGYfXmV+WaNaDo4QKBgQDo+XHYMKgqkfgsf13oRpefBZHIjVGXyZAYNaYnn8oYwq6K0bCAnRvzKD3nJ+Lho+Xg4s4i6q5W6P2ES8HmPGBZJ2ieY3zNDn8DdKR5uB47ys3aKio1XYullGSP3FhEvqtdnVnzvXeiS+GBPljH6kiQL2iDsbxX5ZHkymrm1abHUQKBgQDXgRVKkXLDS0PE/Tc1j5SCLLhWmYH51ORh1v4DJktQVZQZWJmUSnhal5nWJWVwtgAnUBxk8knq3PywPQ5CT2VpC5eCuZPdiyhPSDdYe5sGmCxRH1l3PJN2P0+p66+2dGKdvuZvII0UCuFmRHm/6a5Y20NrimfTS2xfsIv6tEHorwKBgGPreFRMqhN3/4S2K8SPYkAl11y4n6IGJPL9L4IXGkp8VPfc72J5/57OR554kOpNrS5CmD6JgLRtwS2YgFUK2Bfkuw4ThVc9PGRzBofd27mxRZCoPOoecOJXProkuwbg8AZ6kjXjsQe+m70ezF0RsoWEj8LL3AemwmfqGOdgAuPBAoGAb+nXFrxl7sl9TiV5sFT5+IgkysQ5XXaTi8PMcfJHFlb67Ba42uu5iMJF35HYFipN9hyCQmIYxOEyUIvEhecZcO3WJssc4OZNbq7AHzFBlrEcApzXJzbMFZJXWpTM0WGrfOQQYxFyckAcQbG50FIYeoiTgJuFw5LdmuviJbXKrH0CgYBOacYFNwHEuvD2pa5kqNgQSmA/g4ebOluEKqE/O9X9cV43VhDaJvCCaPz8OzYAA3Liqelnc1/rdVjFYQNES/GCErj8Bmk9XogdCyUvIyKDhPWZRcQ//nj4WU0YXEIBpafXKjOCm9fLuaUCWoRrthWpFeNpJ3Gc/2erRvG86NXa6w==',
    // privateKey: 'MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCTqt4xXNhkuaw53PcQpbtJZB+AW10iQbwc0UJmcG+wzKN91cMIJu9o3z3q6ducXSXrAXsYbqQ5WUjY4WqCSktdTYNkNQZdMec/bHp8l8pYLTek4oNPFEMKDD8Lih5oe/pkj2a+Ufti354aN5E1yDmNpjqRwsZDZfup1QLZIAbLq4QW+agy83b1C1JNFX5yo2kLnrjAKWP+2aomh833y8vTflIYdTdq2RKX0lav66ZSOH3VRNqtT+uxDVr4UHVdTQp6qhOb08sfv7129tLFNuxhOOmrJV/bZ8JIGbl6wpvGALIJJxkULxutClz6uBsfhaqQqiXKBfqyDkwMjW+2BUehAgMBAAECggEAbOx/FX5dCH+FMPFzNU5qxgoayn2aR2ihr8gT6KhLWui4OFvzjxHZS0xQyfVSzxZOn/jpqe4DKWJYv9IW1KCk0uAYaVRLq3biEwCboUf+M+i2wONs5GoXwVOjNYneQEgjPQYiTYT/n8E/SCtw63EUMw5I6bf4s0KIzo+XmD1thdGRWYfDDTiCWwqqtp0ZxsutJ5l8JmIwXhyzB27bDSfBaxVubH9yhJG9XgGr6aDPsvn4yPqPXxYEqEzb7kCU/CexqWilOYAUP3nrCEDV1BwkEO+r3/tYMPkl0e0jxtft75owLEpOIVjpI7CRAZ7nCXvQwCZ2Mb7L2KYxGFjkjyYk2QKBgQDMm35BTZq5PdBkw0phug0dNqiZGzDIbPjkhmOQpKllELzR+W+8F2zo/a6hnTLhaM44XDIWUJbrJuyKKRB3aBC2X9Bqyp3XYetZ/mw6UWRAsC4uDR2NmEyo8brD32uBhaaNN/7ZqWbVr3Gd0lemJf1ghc9f9Xcglanw5MLNs/yKTwKBgQC4whEICS3T6B0gIuExWm8mwYM4kPOzMnzsMrFSifM/D3wRMHSJJbWiT7hdqunc7FRWmAjtC33JvS4rgbrwUrsw4h9C8I3GlT5G14jbri49xTV+8S+s1MUrF9iRtez8Mi4xBrF3E2OG/FPIoBGHHYxt3K5crgLpno7Gc7sEQHHDDwKBgCvMeVlnUGCo/8wiFfEXj6kaQzsLHAU7dogM0JFs/in5TEIygB2mchTqARDtgq/H7KUZ70rhk3zhBy+IHNNCvpkbp5TErMcnWecY1HgjZi+Gx0vqWNIvsPFVVaKKWAwQ3RdLzk0vuyiw9sRO+55AcZ3Q5xRmikq6XveHMMAx8DR3AoGBAJFlsC+JwbXtCda7fErxp11xlonSkOZqCiN7dU7GX1Y2ImYIov03XuyAHlAga/C/T1PiS8v4aiJ0LbxxWKM+CDBdE0sDsh8gXiU0A3EWby+PXh0rQ2CZBR13o6hv6jNCblWItepGqOGW+3x8c67IUzY2IEWxb3tYm3WTqA6dhKmDAoGAfZV4JGtBkLtkHae1e3N+7xoGbsoWSSVN/deeD84yUlAV2ETqR8e6q5GQBPJF7kClsDRI2QibJi+//yJlyl8H6HgCgKWsTaXVstqSNAGAqzPLAuii0zAz/kwj2avqIXmShnrH2teIzfoX7AVSpcOwd6pybmiBqU/XCzowc3Z2Jvo=',
    privateKey: fs.readFileSync(
      path.join(__dirname, "private_key.pem"),
      "ascii"
    ),
    signType: 'RSA2',
    // alipayPublicKey: 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1KfYR6uo8Du7Zp8dP5RmiQCApaH1hBOKAguJiFOJmMooMIoE93EYHpGEkJgztBCCByTNatnoZRfq6T1jZTvklKCiAfHK7BW2pip+S+3Ob15FfDpsf0/GWOR7/IFL7vTLp0RwsOzZpz8ZiM3S1YxRAMwkLv8jr970VJH/aySYBGwJYxY/LP+KEjty3NMMjDJWF4nzxkGefoSACVAAa9A2yw4bviXlexojOle7xCbDeFwL0SNw028tdRkiTiN5SXNz3zOGNz7vbMEO+oXPd/kjLDeFBGbyuRPTf8Mx4fqSxI6PphLmELClPOT/XJhF6F4L8aJq9OCju40hbgJa8wc8/wIDAQAB',
    // alipayPublicKey: 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxB73r0GdH0SNYzWO7hHrWt8E3G6F4bBptJ6yQnJ900iguEfkc3rCE0QNdka22iUpfiqt0Cyya6QPvaKKyhk5UYwN2riOWnRWueLFeQ+aEENXFlMEhCOJfjZiDG8fYIb3SqTLb8WjjN7QDFSTm7gMnI+qTDsmrYwDyZs2lN1kxvoKuCe5nylSmYarvubMrEmfEbhJSrD/xbDDhjjVhJokgf3o300pow6sJ3kGyH+69Hbz/YLlFypHgmYMTSXgpufrQEZVuw91gOQaETntWwS/Tmxyxorif/B7TLhDEI81BIsbYiuOMkUQNNbYWqt6qeNHTWLCv6JC49yT3WkCwTSoXwIDAQAB',
    // alipayPublicKey: 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwpBqIQ0czikcgpc8yGQGKulAun3RnG8ZWzzIITM4pLXpPx76PEyjZmoqGXT6Ihl0kTl5kQw2H8ywgmQDhchjAaTeV+6X/EqTXl0vt9XC8aUmxJmyADeEMtP0CjOY4cnAj5+9L4fS9Tx6RtDLd6SCOqIe2MXnJrwaJ+h80UC8IlU5yDJinGvAorhN6bB3lVlVLj5ZvmfcL0OzAz0V6HJCImfANZRSLSd79rtllwdkYbeMivbgT4FRjPV4ADAyvonA2qc0mXdxncb/RKNJN/Br4nEgR/jlrtkcsYOZe3MYOvbhVAT7l0Rd6+5jOIHqJ1e8n+X0HAXhR2isp/M5mibH/QIDAQAB',
    // 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwpBqIQ0czikcgpc8yGQGKulAun3RnG8ZWzzIITM4pLXpPx76PEyjZmoqGXT6Ihl0kTl5kQw2H8ywgmQDhchjAaTeV+6X/EqTXl0vt9XC8aUmxJmyADeEMtP0CjOY4cnAj5+9L4fS9Tx6RtDLd6SCOqIe2MXnJrwaJ+h80UC8IlU5yDJinGvAorhN6bB3lVlVLj5ZvmfcL0OzAz0V6HJCImfANZRSLSd79rtllwdkYbeMivbgT4FRjPV4ADAyvonA2qc0mXdxncb/RKNJN/Br4nEgR/jlrtkcsYOZe3MYOvbhVAT7l0Rd6+5jOIHqJ1e8n+X0HAXhR2isp/M5mibH/QIDAQAB',
    alipayPublicKey: fs.readFileSync(
      path.join(__dirname, "alipay_public_key.pem"),
      "ascii"
    ),
    gateway: "https://openapi.alipaydev.com/gateway.do",
    timeout: 5000,
    camelcase: true
  })
  const formData = new AlipaySdkForm()
  formData.setMethod('get')
  formData.addField('appId', '2016101800717286')
  formData.addField('charset', 'utf-8')
  formData.addField('signType', 'RSA2')
  formData.addField('bizContent', {
    outTradeNo: '1231231237',
    productCode: 'asdasd',
    totalAmount: '1',
    subject: '商品',
    body: '商品详情'
  })
  
  var result = await alipay.exec('alipay.trade.wap.pay', {}, { formData })
  return res.json({
    status: 200,
    result
  })
})

module.exports = router